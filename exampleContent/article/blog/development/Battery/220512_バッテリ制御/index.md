---
date: 2022-05-12
title: "バッテリ制御"
linkTitle: "BatteryManagement"
description: "バッテリ制御に関して，セルのモデル化とEKFを用いたSOC,OCV,SOH推定についてまとめ"
categories: "Development"
pickups: ["Battery"]
tags:
- BMS
- LIB
- EKF
- PlantModel
share: true
toc: true
comment: true
archives: ["2022年5月"]

marp: true
theme: slide_style
size: 16:9
paginate: true
headingDivider: 2
header: バッテリ制御
footer: (C)2022 PUES Corp.
---
# <!-- fit --> :memo: Cellモデリングと拡張カルマンフィルタ(EKF)

<!-- _class: title -->

## はじめに

LIB(リチウムイオン二次電池)のモデリングアプローチとして，以下に分類できると認識している．
1. 等価回路によるモデル(非線形状態方程式/非線形微分方程式)近似
2. 電気化学による第一原理モデル(偏微分方程式)
3. ふるまいモデル(ブラックスボックスモデル)

次に，SOC，SOHなどの内部状態の推定の方法は，一般的には等価回路モデルによる非線形状態方程式を対象に拡張カルマンフィルタ(EKF)もしくは無香料カルマンフィルタ(UKF)などを用いて行われることが多い．
同様に非線形状態方程式を用いて，DeepRL(深層強化学習)での制御アプローチも報告例がある．

<!--

## 構成について

![bg right 50%](2022-05-13-14-59-58.png)
-->

<!--
<img alt="Li-ion battery during charge" src="2022-05-13-14-59-58.png" width="300px">
-->

<!--
- 電解液抵抗 $R_s$(充電/放電)
- 電荷移動抵抗 $R_{ct}$(充電/放電)
- 電気二重層容量 $C_{dl}$(充電/放電)
- 電荷移動抵抗 $R_{ct2}$(充電/放電)
- 電気二重層容量 $C_{dl2}$(充電/放電)
-->

## LIBの非線形性と理由

リチウムイオン二次電池のSOC-OCV 特性は下式のような非線形関数として示される．
$$OCV(t)=f_{ocv}(SOC(t))$$

1. 充電/放電のヒステリシス性(SOC-OCV特性が変化する)
    - 充放電に伴うリチウムイオンの拡散が落ち着くまでの時間($\tau_d$)の影響(数10分から数時間程度)
    - そもそも，最近の電池の特性としてSOC-OCVの関係がフラット気味になってきていると言われている(LFP系(リン酸鉄)等)．
2. OCV応答の時間的特性として，速い応答と遅い応答が含まれる
3. SOC/SOHによる内部パラメータの変動
4. セル温度による内部パラメータの変動

## 等価回路(フォスター型等価回路)

![](2022-05-13-15-20-54.png)

(1),(2),(3)は以下の様な現象特性と関連付けられている
- (1) 電解液内での泳動過程の抵抗 : 溶液抵抗$R_{sol}$，端子抵抗など
- (2) 電極表面の溶媒和・脱溶媒和過程のインピーダンス : 電気二重層容量$C_{dl}$，電荷移動抵抗$R_{ct}$
- (3) リチウムイオンの拡散過程のインピーダンス$Z_w$(ワールブルグインピーダンス)

## パラメータのオフライン同定

パルス放電時のセル端子電圧応答(ステップ応答)から求める方法が提案されている．

例えば以下の様な方法

1. $R_0$をステップ電流の初期応答時間での端子電圧変化量(右図の$V_Ω$)と電流$i$から算出する
2. $R_1$を時定数$\tau_d$の間の変化電圧と電流から算出したものから$R_0$を差し引き算出する
3. $C_1$を$\tau_d/R_1$の関係から算出する．

※ SOC,セル温度と$R_0$, $R_{dl}$, $\tau_d$ は相関があるので，SOC，セル温度水準ごとに計測してLookUpテーブル等で参照することが望ましいと思われる．

![bg right 90%](2022-05-13-18-27-15.png)

## 等価回路のモデル化(非線形状態方程式)

### 前提

1. 簡単のため，フォスター型等価回路のRCネットワークはひとつとする(n=1)  
(※(3)の拡散インピーダンスを独立項としない)
2. 拡散電圧$V_{dl}$ : RCネットワークの電圧降下
3. 端子電圧$V_{bat}$ :
4. 負荷電流$I_{bat}$ : 回路全体の電流

### 状態方程式

$$\begin{bmatrix}SOC_{k+1}\\V_{dl,k+1}\end{bmatrix}=
\begin{bmatrix}1&0\\0&1-\frac{\Delta t}{C_{dl}R_{dl}}\end{bmatrix}\begin{bmatrix}SOC_{k}\\V_{dl,k}\end{bmatrix}+\begin{bmatrix}-\frac{\Delta t}{C_{nom}}\\-\frac{\Delta t}{C_{dl}}\end{bmatrix}I_{bat}$$

$$V_{bat} = f_{OCV}(SOC_k) − R_0 I_{bat} − V_{dl}$$

$R_d$:拡散抵抗($\omega→∞$)，$C_d$は拡散容量，拡散時定数を$\tau_d=R_dC_d$とする．$C_{com}=FCC$ : セル容量(SOH)，$k$ : 離散サンプル

## 拡張カルマンフィルタ(EKF)の適応

### 前提

1. 論文や文献等ではパラメータのオフライン同定を前提としていることが多い．この場合は熱や劣化の影響を考慮しないことになる．
2. 同様に簡易的な事例として説明されているものは，KEFのモデル入力項を電流iのみとしていることが多い．推定したい項の要素数に対して，一つ少ない次元でも解けるので計算量は減るが推定精度は低下するものと思われる．
3. 観測ノイズおよび，

## 課題と発展的な技術

### 課題

線形カルマンフィルタは逐次計算を行う過程で丸め誤差などの蓄積により推定値が発散する(バースト現象)
単精度では問題が顕著になるようで，倍精度浮動小数計算が必要にある．対策として平方根フィルタや正規化などのアプローチ．

パラメータをオフライン同定する場合の欠点を補うために，デュアルEKF(DKEF)を用いて，パラメータのオンライン推定と，状態量をそれぞれ推定する方法が提案されている．
状態とパラメータの同時推定には非線形性が強くなる傾向があるので非線形性に強い無香料カルマンフィルタ(UKF)を用いるなどのアプローチが取られtる．

## 参考文献

1. カルマンフィルタの基礎 (ISBN-13 : 978-4501328900 )
2. バッテリマネジメント工学 (ISBN-13 : 978-4501117207 )

## スライド

<iframe src="slide.html"
            title="スライド表示" width="480" height="270">
</iframe>
